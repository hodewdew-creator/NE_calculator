<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Norepinephrine CRI ê³„ì‚°ê¸°</title>
  <meta name="description" content="ë…¸ë¥´ì—í”¼ë„¤í”„ë¦°(NE) ì—°ì†ì£¼ì… ê³„ì‚° Â· ì¡°ì œ ë ˆì‹œí”¼ ì‚°ì¶œ (ì›ì•¡ 4 mg/4 mL/ì•°í”Œ = 1 mg/mL)" />
  <style>
    :root{ --blue:#1d4ed8; --lightblue:#dbeafe; --red:#dc2626; --redlight:#fef2f2; --redborder:#fca5a5; --muted:#64748b; --bg:#f8fafc; --card:#fff; --border:#e5e7eb; }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:#0f172a;padding:12px}
    h2{margin:0 0 12px;font-size:1.35rem;color:var(--blue);text-align:center}
    h3{margin:0 0 8px;font-size:1.05rem;color:#111}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:stretch}
    .ibox{border:2px solid var(--blue);border-radius:10px;padding:10px;background:#f9fafb;min-width:180px;flex:1;display:flex;flex-direction:column;justify-content:flex-start;position:relative}
    label{display:block;font-size:.9rem;color:var(--blue);margin-bottom:6px}
    input[type=number]{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;background:#fff;font-size:1rem}
    input:focus{outline:none;border-color:var(--blue)}
    .muted{color:#64748b}
    .dose-buttons{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-size:1rem}
    .btn.active{border-color:var(--blue);background:#eff6ff;color:#1e40af}
    table{width:100%;border-collapse:collapse;font-size:.95rem}
    th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
    td.bold{font-weight:700}
    .right{text-align:right}
    .total{background:#eff6ff;font-weight:700}
    .warn{font-size:0.9rem;color:#b91c1c;background:#fef2f2;border:1px solid var(--redborder);padding:10px;border-radius:10px}
    .ok{font-size:0.9rem;color:#1e3a8a;background:#eff6ff;border:1px solid #bfdbfe;padding:10px;border-radius:10px}
    .seg{display:flex;gap:8px;flex-wrap:wrap}
    .seg label{color:#111;margin:0;font-size:1rem}
    .seg .chip{display:inline-flex;align-items:center;gap:6px;border:2px solid var(--border);padding:12px 18px;border-radius:999px;background:#fff;cursor:pointer;transition:all .2s;font-size:1.05rem}
    .seg input{display:none}
    .seg input:checked + span{background:var(--lightblue);color:#000;border-color:var(--blue);font-weight:700}
    .hidden{display:none}
    .bignum{font-size:1.5rem;padding:14px 40px 14px 16px;text-align:center;border-width:2px}
    .unit-label{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:1rem;color:#374151}
  </style>
</head>
<body>
  <h2>Norepinephrine CRI ê³„ì‚°ê¸°</h2>

  <div class="card">
    <h3>âš™ï¸ ê¸°ë³¸ ì…ë ¥ <span style='font-size:0.85em'>(NE 4mg/ 4mL/ 1ì•°í”Œ)</span></h3>
    
    <div class="row">
      <div class="ibox"><label for="bw">ì²´ì¤‘ (kg) <span style='color:#1d4ed8;font-size:0.8em'>*í•„ìˆ˜ì…ë ¥</span></label><input id="bw" type="number" step="0.1"></div>
      <div class="ibox"><label for="flow">ìˆ˜ì•¡ì†ë„ (mL/hr) <span style='color:#1d4ed8;font-size:0.8em'>*í•„ìˆ˜ì…ë ¥</span></label><input id="flow" type="number" step="0.1"></div>
    </div>

    <div class="ibox" style="margin-top:10px">
      <label>ìš©ëŸ‰ ì„ íƒ (Âµg/kg/min)</label>
      <div id="doseBtns" class="dose-buttons"></div>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ§ª ì¡°ì œ ê¸°ì¤€ ì„ íƒ</h3>
    <div class="ibox">
      <div class="seg" id="modeSeg">
        <label class="chip"><input type="radio" name="mode" value="time"><span> ì´ì‹œê°„</span></label>
        <label class="chip"><input type="radio" name="mode" value="volume"><span>ì´ëŸ‰</span></label>
        <label class="chip"><input type="radio" name="mode" value="default" checked><span>ìˆ˜ì•¡ 100mL ê¸°ì¤€</span></label>
      </div>
      <div class="row" style="margin-top:10px">
        <div class="ibox mode-input mode-time hidden" style="max-width:220px">
          <input id="hours" class="bignum" type="number" step="1" min="1" placeholder="12">
          <span class="unit-label">hr</span>
        </div>
        <div class="ibox mode-input mode-volume hidden" style="max-width:220px">
          <input id="volume" class="bignum" type="number" step="1" min="1" placeholder="60">
          <span class="unit-label">mL</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ“Š ì¡°ì œ ë ˆì‹œí”¼</h3>
    <table>
      <tbody>
        <tr><td>ì‹œê°„ë‹¹ ì•½ë¬¼ëŸ‰</td><td class="right" id="needPerHr">-</td></tr>
        <tr><td>ì´ ì¡°ì œëŸ‰</td><td class="right" id="totalV">-</td></tr>
        <tr><td class="bold">ì•½ë¬¼(NE)ëŸ‰ / ìˆ˜ì•¡ëŸ‰</td><td class="right bold" id="mixPair">-</td></tr>
      </tbody>
      <tfoot>
        <tr class="total"><td>ì•°í”Œ</td><td class="right" id="ampCount">-</td></tr>
      </tfoot>
    </table>
  </div>

  <script>
    // ìƒìˆ˜
    const STOCK_MG_ML = 1.0; // 4 mg/4 mL
    const AMPULE_ML = 4.0;   // 1ì•°í”Œ 4 mL (=4 mg)
    const DOSES = [0.5, 1, 2];

    // ë¹ ë¥¸ ì°¸ì¡°
    const $ = (q)=>document.querySelector(q);
    const bw = $('#bw');
    const flow = $('#flow');
    const hours = $('#hours');
    const volume = $('#volume');
    const needPerHr = $('#needPerHr');
    const totalV = $('#totalV');
    const mixPair = $('#mixPair');
    const ampCount = $('#ampCount');

    const fmt = (x)=> (isFinite(x)? Number(x).toFixed(1) : '-'); // ì†Œìˆ˜ì  1ìë¦¬ ê³ ì •

    // ìš©ëŸ‰ ë²„íŠ¼
    let selectedDose = DOSES[0];
    function renderDoseBtns(){
      const wrap = $('#doseBtns');
      wrap.innerHTML = '';
      DOSES.forEach(d=>{
        const b = document.createElement('button');
        b.className = 'btn'+(d===selectedDose?' active':'');
        b.textContent = d;
        b.onclick = ()=>{ selectedDose=d; renderDoseBtns(); recalc(); };
        wrap.appendChild(b);
      });
    }
    renderDoseBtns();

    // ëª¨ë“œ ì„ íƒ
    let mode = 'default'; // 'time' | 'volume' | 'default'
    document.querySelectorAll('input[name="mode"]').forEach(r=>{
      r.addEventListener('change', ()=>{ mode = r.value; updateModeUI(); recalc(); });
    });
    function updateModeUI(){
      document.querySelectorAll('.mode-input').forEach(div=>div.classList.add('hidden'));
      if(mode==='time'){
        document.querySelector('.mode-time').classList.remove('hidden');
      }else if(mode==='volume'){
        document.querySelector('.mode-volume').classList.remove('hidden');
      }else{
        // default: ë‘˜ ë‹¤ ìˆ¨ê¹€, ìˆ˜ì•¡ 100 mL ê¸°ì¤€ ì‚¬ìš©
      }
    }
    updateModeUI();

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    [bw,flow,hours,volume].forEach(el=>['input','change','keyup'].forEach(ev=>el.addEventListener(ev,recalc)));

    function recalc(){
      const W = parseFloat(bw.value);
      const F = parseFloat(flow.value);
      const D = selectedDose;

      // í•„ìˆ˜: W, F
      if(!(W>0) || !(F>0)){
        needPerHr.textContent = '-';
        totalV.textContent = '-';
        mixPair.textContent = '-';
        ampCount.textContent = '-';
        return;
      }

      // íˆ¬ì—¬ëŸ‰(ì‹œê°„ë‹¹)
      const ug_per_hr = D * W * 60; // (Âµg/kg/min)*kg*60 = Âµg/hr
      const mg_per_hr = ug_per_hr / 1000.0; // mg/hr
      needPerHr.textContent = `${fmt(ug_per_hr)} Âµg/hr`;

      // ëª¨ë“œë³„ ì´ë¶€í”¼ ê³„ì‚°
      let V;
      let stock_mL;
      if(mode==='time'){
        const H = parseFloat(hours.value) || parseFloat(hours.placeholder);
        V = (H>0) ? F * H : NaN;
        const C_mg_mL = mg_per_hr / F;
        stock_mL = (C_mg_mL * V) / STOCK_MG_ML;
      } else if(mode==='volume'){
        const Vin = parseFloat(volume.value) || parseFloat(volume.placeholder);
        V = (Vin>0) ? Vin : NaN;
        const C_mg_mL = mg_per_hr / F;
        stock_mL = (C_mg_mL * V) / STOCK_MG_ML;
      } else {
        // default: ìˆ˜ì•¡ëŸ‰ì„ 100mLë¡œ ê³ ì •, ì›ì•¡ + ìˆ˜ì•¡ í•©ê³„ê°€ ì´ ì¡°ì œëŸ‰ì´ ë¨
        const diluent_mL = 100;
        const C_mg_mL = mg_per_hr / F;
        stock_mL = (C_mg_mL * diluent_mL) / STOCK_MG_ML;
        V = stock_mL + diluent_mL;
      }

      if(!isFinite(V) || !isFinite(stock_mL)){
        totalV.textContent = '-';
        mixPair.textContent = 'ì£¼ì…ì‹œê°„ ë˜ëŠ” ì´ ì¡°ì œ ìš©ëŸ‰ ì¤‘ í•˜ë‚˜ë¥¼ ì…ë ¥í•˜ì„¸ìš” (í˜¹ì€ ê¸°ë³¸ 100 mL ìˆ˜ì•¡ ê¸°ì¤€).';
        ampCount.textContent = '-';
        return;
      }

      totalV.textContent = `${fmt(V)} mL`;

      const dil_mL = V - stock_mL;
      if(stock_mL > V || stock_mL < 0){
        mixPair.textContent = 'âš ï¸ ì›ì•¡ì´ ìˆ˜ì•¡ëŸ‰ì„ ì´ˆê³¼í•©ë‹ˆë‹¤. ìˆ˜ì•¡ì†ë„ë¥¼ ë†’ì´ê±°ë‚˜ ì´ë¶€í”¼/ê¸°ì¤€ì„ ì¬ì„¤ì •í•˜ì„¸ìš”.';
        ampCount.textContent = '-';
        return;
      }

      mixPair.textContent = `ì•½ë¬¼ ${fmt(stock_mL)} mL + ìˆ˜ì•¡ ${fmt(dil_mL)} mL`;

      // ì•°í”Œ ê°œìˆ˜
      const ampExact = stock_mL / AMPULE_ML;
      ampCount.textContent = `${fmt(ampExact)} ê°œ (=${fmt(stock_mL)} mL)`;
    }

    // ì´ˆê¸° ê³„ì‚° ì‹œë„
    recalc();
  </script>
</body>
</html>
